<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="format-detection" content="telephone=no" />
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    	<meta name="apple-mobile-web-app-capable" content="yes">
    	<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>新闻列表</title>
		<link rel="stylesheet" href="../../css/api.css" />
		<link rel="stylesheet" href="../../css/mui.min.css" />
		<script src="../../script/common.js"></script>
		<style type="text/css">
			*{
				box-sizing: content-box;
				-webkit-box-sizing: content-box;
				background-color: #fff;
			}
			.clearfix:before{
				content: '';
				height: 0;
				line-height: 0;
				display: block;
				visibility: hidden;
				clear: both;
			}
			.news{
				width: 100%;
				min-width: 320px;
			}
			.head{
				font-size: 18px;
				padding:  0 15px;
				line-height: 48px;
				height: 48px;
				background-color: #f6f6f6;
			}
			.head .backbtn{
				float: left;
				line-height: 48px;
			}
			.head .backbtn img{
				width: 15px;
				height: 23px;
				vertical-align: middle;
				background-color: #f6f6f6;
			}
			.head div{
				text-align: center;
				line-height: 48px;
				height: 48px;
				background-color: #f6f6f6;
				
			}
			.newsnav{
				box-sizing: border-box;
				height: 48px;
				float: left;
				border-bottom: 6px solid #F6F6F6;
				overflow-x: scroll;
			}
			.newsnav li{
				
				line-height: 48px;
				float: left;
				box-sizing: border-box;
				/*display: inline-block;*/
				width: 20%;
				text-align: center;
				color: #333;
			}
			
			li.spg{
				color: dodgerblue;
				background-color: #F6F6F6;
			}
		</style>
	</head>
	<body>
		<div class="newslist_h clearfix" id="topbar" style="display: block;">
			<div class="head clearfix">
				<div class="backbtn " onclick="api.closeWin()">
					<img src="../../image/back.png" alt="" />
				</div>
				<div>新闻资讯</div>
			</div>
			<ul class="newsnav clearfix">
				
			</ul>
			
		</div>
	</body>
	
	<script id="newslist" type="text/html">
		<%for(var i=0;i<msg.length;i++){%>
			<li class="clearfix"><%=msg[i]%></li>
		<%}%>
	</script>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/mui.min.js"></script>
	<script src="../../script/jquery-3.2.1.min.js"></script>
	<script src="../../script/template-native.js"></script>
	<script src="../../script/zepto.min.js"></script>
	<script src="../../script/apiCloud.js"></script>
	<script>
		var lis=[];
		
		apiready = function(){
			var head = $api.dom('#topbar');
			$api.fixStatusBar(head);		//沉浸式，自动给当前的头部添加状态栏的高度，以内边距padding-top的方式
			head.style.display = "block";
			head_h = head.offsetHeight;
			bottom_h=0;
			api.ajax({
			    url: 'http://api.jisuapi.com/news/channel?appkey=61bdbb002f1edc13',
			    method: 'get'
			}, function(ret,err){
				var frameArr = []
				if(ret){
					var data = {msg:ret.result};	
					var html = template('newslist',data);
			        document.querySelector(".newsnav").innerHTML = html;
			        for(var j=0;j<ret.result.length;j++){
			        	$(frameArr).push({
					        name: 'frame'+j,
					        url: 'newslist.html'
					    })
			        }
				}else{
					alert(JSON.stringify(err.msg))
				}
				lis = $api.domAll('li');
				alert(JSON.stringify(lis));
				if(tk()){
					tk();
				}else{
					$api.addCls(lis[0],'spg');
					var tom = $api.html($api.dom('.spg'));
			        alert(tom)
			        var pm = {tm:tom};
//			        initOpen(pm);
			        api.openFrameGroup({
					    name: 'newslist_body',
					    rect: {
					        x: 0,
					        y: head_h,
					        w: api.frameWidth,
					        h: api.winHeight-head_h-bottom_h
					    },
					    frames: [{
					        name: 'frame1',
					        url: 'newslist_body.html',
					        bgColor: '#fff'
					    }, {
					        name: 'frame2',
					        url: 'frame2.html',
					        bgColor: '#fff'
					    }]
					}, function(ret, err) {
					    var index = ret.index;
					});
//			        openNewFrames(api.winName+'_body','./'+api.winName+'_body.html',pm,head_h,bottom_h)
			        alert(JSON.stringify(pm))
				}
			});
			tk();
		}
		
		function tk(){
			for (var i=0;i<lis.length;i++){
	        	$(lis[i]).click(function(){
	        		$(lis).removeClass('spg');
	        		$(this).addClass('spg');
	        		var tom = $api.html($api.dom('.spg'));
			        var pm = {tm:tom};
			        openNewFrames(api.winName+'_body','./'+api.winName+'_body.html',pm,head_h,bottom_h);
			        alert(JSON.stringify(pm));
	        	})
			}
		}
	</script>
</html>
